"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getStaticProps = exports.getServerSideProps = exports.NextTemplateLoader = void 0;
const react_1 = __importDefault(require("react"));
const dynamic_1 = __importDefault(require("next/dynamic"));
const hooks_1 = require("./hooks");
const react_2 = require("../react");
const utils_1 = require("./utils");
const api_1 = require("../api");
const utils_2 = require("../utils");
const config_1 = require("../config");
function NextTemplateLoader({ templates, }) {
    const uriInfo = hooks_1.useUriInfo();
    if (!uriInfo) {
        return null;
    }
    return (react_1.default.createElement(react_2.TemplateLoader, { dynamicLoader: dynamic_1.default, templates: templates, uriInfo: uriInfo }));
}
exports.NextTemplateLoader = NextTemplateLoader;
async function getTemplate(context, templates) {
    const client = api_1.getApolloClient(context);
    const wpeConfig = config_1.headlessConfig();
    const currentUrlPath = utils_2.resolvePrefixedUrlPath(utils_1.getCurrentPath(context), wpeConfig.uriPrefix);
    const pageInfo = await api_1.getUriInfo(client, currentUrlPath);
    return react_2.resolveTemplate(pageInfo, templates);
}
async function getServerSideProps(context, templates) {
    const template = await getTemplate(context, templates);
    if (template === null || template === void 0 ? void 0 : template.getServerSideProps) {
        return template.getServerSideProps(context);
    }
}
exports.getServerSideProps = getServerSideProps;
async function getStaticProps(context, templates) {
    const template = await getTemplate(context, templates);
    if (template === null || template === void 0 ? void 0 : template.getStaticProps) {
        return template.getStaticProps(context);
    }
}
exports.getStaticProps = getStaticProps;
