"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WPHead = void 0;
const react_1 = __importDefault(require("react"));
const head_1 = __importDefault(require("next/head"));
const hooks_1 = require("./hooks");
const react_2 = require("../react");
function WPHead() {
    var _a, _b, _c;
    const settings = react_2.useGeneralSettings();
    const post = hooks_1.usePost();
    let title = 'Loading...';
    let stylesheets = [];
    const siteTitle = (_a = settings === null || settings === void 0 ? void 0 : settings.title) !== null && _a !== void 0 ? _a : '';
    const siteTagline = (_b = settings === null || settings === void 0 ? void 0 : settings.description) !== null && _b !== void 0 ? _b : '';
    if (post === null || post === void 0 ? void 0 : post.title) {
        title = `${post.title} – ${siteTitle}`;
    }
    else if (siteTitle && siteTagline) {
        title = `${siteTitle} – ${siteTagline}`;
    }
    if ((_c = post === null || post === void 0 ? void 0 : post.enqueuedStylesheets) === null || _c === void 0 ? void 0 : _c.nodes) {
        stylesheets = post.enqueuedStylesheets.nodes.filter((node) => {
            if (!node || !node.src) {
                return false;
            }
            return node.src.indexOf('wp-content/themes') < 0;
        });
    }
    const stylesheetUrl = (stylesheet) => {
        const WP_URL = (settings === null || settings === void 0 ? void 0 : settings.url) || '';
        return stylesheet.src.indexOf('http') === 0
            ? stylesheet.src
            : `${WP_URL}${stylesheet.src}`;
    };
    return (react_1.default.createElement(head_1.default, null,
        react_1.default.createElement("title", null, title),
        stylesheets.map((stylesheet) => {
            if (!stylesheet.src) {
                return null;
            }
            return (react_1.default.createElement("link", { href: stylesheetUrl(stylesheet), rel: "stylesheet", key: stylesheet.handle }));
        })));
}
exports.WPHead = WPHead;
